{% extends 'admin_panel/base.html' %}
{% load static %}
{% block content %}
<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <img src="{% static 'images/logo.png' %}" alt="Lush Dairy Logo">
      
    </div>
    <div class="nav-menu">
      <a href="{% url 'admin_panel:admin_dashboard' %}" class="nav-item">
  <i class="fas fa-tachometer-alt"></i> Dashboard
</a>
<a href="{% url 'admin_panel:admin_order_list' %}" class="nav-item active">
  <i class="fas fa-shopping-cart"></i> Orders
</a>
<a href="{% url 'admin_panel:product_list' %}" class="nav-item">
  <i class="fas fa-box"></i> Products
</a>
<a href="{% url 'admin_panel:sales_report' %}" class="nav-item">
  <i class="fas fa-chart-line"></i> Sales Report
</a>
<a href="{% url 'admin_panel:user_list' %}" class="nav-item">
  <i class="fas fa-users"></i> Customers
</a>
<a href="{% url 'admin_panel:category_list' %}" class="nav-item">
  <i class="fas fa-tags"></i> Categories
</a>
<a href="{% url 'admin_panel:inventory_list' %}" class="nav-item">
  <i class="fas fa-warehouse"></i> Stock
</a>
<a href="{% url 'admin_panel:coupon_list' %}" class="nav-item">
  <i class="fas fa-ticket-alt"></i> Coupons
</a>
<a href="{% url 'admin_panel:offer_list' %}" class="nav-item">
  <i class="fas fa-bullhorn"></i> Offers
</a>
<a href="{% url 'admin_panel:wallet_transactions_list' %}" class="nav-item">
  <i class="fas fa-wallet"></i> Wallet
</a>
<a href="{% url 'admin_panel:admin_return_requests' %}" class="nav-item">
  <i class="fas fa-exchange-alt"></i> Complaints
</a>
<a href="{% url 'admin_panel:admin_logout' %}" class="nav-item">
  <i class="fas fa-sign-out-alt"></i> Sign Out
</a>
    </div>
  </div>

  <!-- Main content -->
  <div class="main-content">
    <!-- Header -->
    <div class="header d-flex justify-content-between align-items-center mb-4">
      <form class="search-bar" method="get" action="{% url 'admin_panel:admin_return_requests' %}">
        <input type="text" name="search" placeholder="Search complaints or orders...">
        <button type="submit"><i class="fas fa-search"></i></button>
      </form>
      <div class="user-info d-flex align-items-center">
        <div class="avatar"><i class="fas fa-user"></i></div>
        <span class="ms-2">Admin</span>
      </div>
    </div>

    <!-- Complaints Section -->
    <div class="categories-section">
      <div class="section-header d-flex justify-content-between align-items-center mb-3">
        <h2 class="section-title">Complaints & Issues</h2>
      </div>
      <div class="table-responsive">
        <table class="categories-table table-hover">
          <thead>
            <tr>
              <th>#ID</th>
              <th>User</th>
              <th>Order ID</th>
              <th>Type</th>
              <th>Product / Reason</th>
              <th>Amount</th>
              <th>Image</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for r in return_requests %}
            <tr>
              <td>#{{ r.id }}</td>
              <td>{{ r.user.email }}</td>
              <td>{{ r.order.order_id }}</td>
              <td class="text-center">
                {% if r.order_item %}
                  <span class="badge badge-warning">Item Refund</span>
                {% else %}
                  <span class="badge badge-info">Full Order</span>
                {% endif %}
              </td>
              <td>
                {% if r.order_item %}
                  {{ r.order_item.product.name }}<br>
                  <small>{{ r.reason|truncatechars:50 }}</small>
                {% else %}
                  {{ r.reason|truncatechars:60 }}
                {% endif %}
              </td>
              <td class="text-center">â‚¹{{ r.refund_amount }}</td>
              <td class="text-center">
                {% if r.image %}
                  <img src="{{ r.image.url }}" class="img-thumbnail" style="width:50px; height:50px;">
                {% else %}
                  <span class="text-muted small">No Image</span>
                {% endif %}
              </td>
              <td class="text-center">
                {% if r.verified %}
                  {% if r.refunded %}
                    <span class="badge badge-success">Refunded</span>
                  {% else %}
                    <span class="badge badge-danger">Rejected</span>
                  {% endif %}
                {% else %}
                  <span class="badge badge-secondary">Pending</span>
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{% url 'admin_panel:approve_return_request' r.id %}" class="btn btn-primary btn-sm mb-1">
                  {% if not r.verified %}Verify{% elif not r.refunded %}Proceed{% else %}Done{% endif %}
                </a>
                {% if r.verified and not r.refunded %}
                <a href="{% url 'admin_panel:reject_return_request' r.id %}" class="btn btn-secondary btn-sm mb-1">Reject</a>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="9" class="text-center">No complaints found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination mt-3">
        {% if return_requests.has_previous %}
          <a href="?page={{ return_requests.previous_page_number }}">&laquo;</a>
        {% endif %}
        <span class="current">{{ return_requests.number }}</span>
        {% if return_requests.has_next %}
          <a href="?page={{ return_requests.next_page_number }}">&raquo;</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
/* Container & Layout */
.container {
  display: flex;
  min-height: 100vh;
}
.sidebar {
  width: 240px;
  background-color: white;
  box-shadow: 2px 0 5px rgba(0,0,0,0.1);
  padding: 20px 0;
}
.sidebar .logo {
  display: flex;
  align-items: center;
  padding: 0 20px 20px;
  border-bottom: 1px solid #ddd;
}
.sidebar .logo img {
  height: 40px;
  margin-right: 10px;
}
.sidebar .logo h2 {
  font-size: 18px;
  color: #4d8b31;
}
.nav-menu .nav-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  font-size: 14px;
  color: #333;
  text-decoration: none;
  transition: all 0.3s;
}
.nav-menu .nav-item i {
  margin-right: 10px;
}
.nav-menu .nav-item.active, .nav-menu .nav-item:hover {
  background-color: #e8f5e9;
  color: #4d8b31;
  border-left: 4px solid #4d8b31;
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
.search-bar {
  display: flex;
  align-items: center;
  background-color: white;
  border-radius: 20px;
  padding: 5px 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.search-bar input {
  border: none;
  outline: none;
  padding: 5px;
}
.search-bar button {
  border: none;
  background: transparent;
  cursor: pointer;
}
.user-info .avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: #4d8b31;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Table */
.categories-section {
  background-color: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}
.categories-table {
  width: 100%;
  border-collapse: collapse;
}
.categories-table th, .categories-table td {
  padding: 12px 15px;
  font-size: 14px;
  vertical-align: middle;
}
.categories-table th {
  background-color: #f5f5f5;
  font-weight: 500;
}
.categories-table tr {
  border-bottom: 1px solid #ddd;
  transition: background 0.3s;
}
.categories-table tr:hover {
  background-color: #f0f9f0;
}
.img-thumbnail {
  border-radius: 4px;
  object-fit: cover;
}

/* Badges */
.badge {
  display: inline-block;
  padding: 3px 8px;
  font-size: 12px;
  border-radius: 12px;
  color: white;
  font-weight: 500;
}
.badge-warning { background-color: #f0ad4e; }
.badge-info    { background-color: #5bc0de; }
.badge-success { background-color: #5cb85c; }
.badge-danger  { background-color: #d9534f; }
.badge-secondary { background-color: #6c757d; }

/* Buttons */
.btn-sm {
  padding: 5px 10px;
  font-size: 13px;
  border-radius: 4px;
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: center;
  margin-top: 15px;
}
.pagination a, .pagination span {
  padding: 5px 10px;
  margin: 0 3px;
  border-radius: 4px;
}
.pagination .current {
  background-color: #4d8b31;
  color: white;
}
.pagination a {
  background-color: #f5f5f5;
  text-decoration: none;
  color: #333;
}

/* Responsive */
@media (max-width: 768px) {
  .container { flex-direction: column; }
  .sidebar { width: 100%; }
  .header { flex-direction: column; align-items: flex-start; }
  .search-bar { width: 100%; margin-bottom: 10px; }
}
</style>
{% endblock %}
